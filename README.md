# üìß Email Payment Processor

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Python –∏ Docker.

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- üìß –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ –ø–∏—Å—å–º–∞ —Å –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ IMAP
- üîç –ò—â–µ—Ç –≤ –ø–∏—Å—å–º–∞—Ö —Å—Å—ã–ª–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- ü§ñ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–æ–≤
- üì¶ –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏–≤—ã (ZIP, RAR, 7Z)
- üìä –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç CSV —Ñ–∞–π–ª—ã —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- üí∞ –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø–ª–∞—Ç–∞—Ö —Å–æ–≥–ª–∞—Å–Ω–æ –∑–∞–¥–∞–Ω–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
- üîó –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook —Å –¥–∞–Ω–Ω—ã–º–∏ –æ–± –æ–ø–ª–∞—Ç–∞—Ö –Ω–∞ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### üöÄ –ì–æ—Ç–æ–≤—ã–π –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é (—Ç–æ–ª—å–∫–æ Docker)

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ email –∏ webhook
# 2. –°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑:
docker-compose build email-processor
# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±):
docker-compose up email-processor
```

‚ö†Ô∏è **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:**
- **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:** `docker rm email-processor` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
- **–û—à–∏–±–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞:** –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker Desktop –∏–ª–∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ 15 –º–∏–Ω—É—Ç

### Docker (–ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/kodjooo/email-payment-processor.git
cd email-processor

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (—Ä—è–¥–æ–º —Å docker-compose.yml)
nano .env

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±)
docker-compose up email-processor

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ —á–µ—Ä–µ–∑ docker run
docker run --rm --name email-processor --env-file .env emailprocessor-email-processor:latest

# –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–µ—Å–ª–∏ –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–º–µ–Ω)
docker-compose up email-processor

# –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
docker rm email-processor
docker-compose up email-processor

# –ü–æ–ª–µ–∑–Ω—ã–µ Docker –∫–æ–º–∞–Ω–¥—ã:
docker ps -a                             # –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps -a | grep email-processor      # –¢–æ–ª—å–∫–æ email-processor –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker rm email-processor                # –£–¥–∞–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker logs email-processor              # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ (–µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω)
docker images | grep cursor              # –°–ø–∏—Å–æ–∫ –æ–±—Ä–∞–∑–æ–≤
docker-compose build email-processor     # –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
cd email-processor
pip install -r requirements.txt
python src/main.py --mode once
```

## üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (—Ä—è–¥–æ–º —Å `docker-compose.yml`) —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:

```env
# Email Configuration (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
EMAIL_ADDRESS=your_email@gmail.com
EMAIL_PASSWORD=your_app_password
IMAP_SERVER=imap.gmail.com
IMAP_PORT=993
MAILBOX=INBOX
USE_SSL=true

# Webhook Configuration (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
WEBHOOK_URL=https://your-server.com/webhook/payments
WEBHOOK_TOKEN=your_secret_token
WEBHOOK_TIMEOUT=30

# CSV Processing Configuration
CSV_FILTER_COLUMN="–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞"
CSV_FILTER_VALUE="–ê–û \"–¢–ë–∞–Ω–∫\""
PAYMENT_AMOUNT_COLUMN="–°—É–º–º–∞ –≤ –≤–∞–ª—é—Ç–µ —Å—á—ë—Ç–∞"
PAYMENT_DATE_COLUMN="–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è"
PAYMENT_ID_COLUMN="–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞"
CUSTOMER_ID_COLUMN="–ò–ù–ù –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞"

# Browser Configuration
BROWSER_HEADLESS=true
DOWNLOAD_TIMEOUT=60
IMPLICIT_WAIT=10

# Logging
LOG_LEVEL=INFO
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
üìß Email Server ‚Üí üì® Email Handler ‚Üí üîç Link Extraction ‚Üí 
ü§ñ Browser Automation ‚Üí üì¶ File Download ‚Üí üóÉÔ∏è Archive Extraction ‚Üí 
üìä CSV Processing ‚Üí üí∞ Payment Extraction ‚Üí üì° Webhook Sender ‚Üí üñ•Ô∏è External Server
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
email-processor-root/
‚îú‚îÄ‚îÄ README.md                    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml           # Docker –∫–æ–º–ø–æ–∑–∏—Ü–∏—è
‚îú‚îÄ‚îÄ .gitignore                   # Git –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îî‚îÄ‚îÄ email-processor/             # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    ‚îú‚îÄ‚îÄ src/                     # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
    ‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
    ‚îÇ   ‚îú‚îÄ‚îÄ email_handler.py     # –†–∞–±–æ—Ç–∞ —Å email
    ‚îÇ   ‚îú‚îÄ‚îÄ email_tracking.py    # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø–∏—Å–µ–º
    ‚îÇ   ‚îú‚îÄ‚îÄ browser_automation.py # –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
    ‚îÇ   ‚îú‚îÄ‚îÄ file_processor.py    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
    ‚îÇ   ‚îî‚îÄ‚îÄ webhook_sender.py    # –û—Ç–ø—Ä–∞–≤–∫–∞ webhook
    ‚îú‚îÄ‚îÄ config/                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îÇ   ‚îî‚îÄ‚îÄ config.py            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    ‚îú‚îÄ‚îÄ downloads/               # –°–∫–∞—á–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (Docker volume)
    ‚îú‚îÄ‚îÄ logs/                    # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Docker volume)
    ‚îú‚îÄ‚îÄ requirements.txt         # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    ‚îú‚îÄ‚îÄ Dockerfile              # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ .env                         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Å–æ–∑–¥–∞—Ç—å –≤ –∫–æ—Ä–Ω–µ)
```

## üîß –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è
- ‚úÖ **Docker –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –≤–µ–±-—Ñ–æ—Ä–º
- ‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∞—Ä—Ö–∏–≤–æ–≤** - ZIP, RAR, 7Z
- ‚úÖ **–ì–∏–±–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ CSV** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–æ–ª—è –∏ —É—Å–ª–æ–≤–∏—è
- ‚úÖ **Webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìä –§–æ—Ä–º–∞—Ç Webhook

```json
{
  "timestamp": "2025-08-31T14:58:37.189815",
  "data": {
    "payments_count": 2,
    "payments": [
      {
        "transaction_id": "2491",
        "customer_id": 772746611830,
        "amount": 2500,
        "currency": "RUB",
        "date": "2025-08-28T00:00:00",
        "purpose": "–ù–î–° –Ω–µ –æ–±–ª–∞–≥–∞–µ—Ç—Å—è. –°—á—ë—Ç 2491",
        "source_file": "–í—ã–ø–∏—Å–∫–∞_–û–û–û \"–ê–î–í–ê–ù–¢–û\"_40702810810001014566_28.08.2025-28.08.2025.csv"
      },
      {
        "transaction_id": "2497", 
        "customer_id": 7751019223,
        "amount": 2500,
        "currency": "RUB",
        "date": "2025-08-28T00:00:00",
        "purpose": "–û–ø–ª–∞—Ç–∞ –ø–æ —Å—á–µ—Ç—É ‚Ññ2497 –æ—Ç 28.08.2025 –≥., –∑–∞ —É—Å–ª—É–≥–∏. –°—É–º–º–∞ 2500-00 —Ä—É–±. –ë–µ–∑ –ù–î–°",
        "source_file": "–í—ã–ø–∏—Å–∫–∞_–û–û–û \"–ê–î–í–ê–ù–¢–û\"_40702810810001014566_28.08.2025-28.08.2025.csv"
      }
    ]
  }
}
```

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- Google Chrome (–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏)
- IMAP –¥–æ—Å—Ç—É–ø –∫ email
- Docker (–¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏)

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Docker

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏)
docker-compose up email-processor

# –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose up email-processor

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
docker-compose logs email-processor
docker-compose logs --tail=100 email-processor  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫

# –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫
docker-compose up --force-recreate email-processor

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (–ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ)
docker-compose down
docker-compose up --build email-processor

# –û—á–∏—Å—Ç–∫–∞ volumes (—É–¥–∞–ª–∏—Ç –ª–æ–≥–∏ –∏ —Å–∫–∞—á–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã)
docker-compose down -v
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

```bash
# –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
docker-compose exec email-processor bash

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats email-processor

# –ü—Ä–æ—Å–º–æ—Ç—Ä volumes
docker volume ls | grep email-processor

# –ü—É—Ç—å –∫ –ª–æ–≥–∞–º –Ω–∞ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–µ
docker volume inspect emailprocessor_email_processor_logs
```

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ **–∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏** –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø–∏—Å–µ–º –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.

```bash
# –†–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±)
docker-compose up email-processor

# –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
docker-compose up email-processor

# –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω:
docker rm email-processor
docker-compose up email-processor

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ (–ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞)
docker-compose build email-processor

# –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
docker-compose up email-processor

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker run:
docker run --rm --name email-processor --env-file .env emailprocessor-email-processor:latest
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –†–µ–∂–∏–º `restart: "no"` - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å –∫–æ–¥–æ–º 0
- –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã—à–µ
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üïí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤ 12:00 –ú–°–ö

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
./setup_cron.sh

# –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
crontab -e
# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É (–¥–ª—è –ª–µ—Ç–Ω–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ú–°–ö):
0 9 * * * /usr/local/other-scripts/email-processor/run_email_processor.sh >/dev/null 2>&1

# –î–ª—è –∑–∏–º–Ω–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ú–°–ö (–Ω–æ—è–±—Ä—å-—Ñ–µ–≤—Ä–∞–ª—å):
0 8 * * * /usr/local/other-scripts/email-processor/run_email_processor.sh >/dev/null 2>&1
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è

‚úÖ **–ù–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `docker compose run --rm`  
‚úÖ **–ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** - –≤—Å–µ –ª–æ–≥–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `cron.log`  
‚úÖ **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞** - —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π  
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫** - –∫–æ–¥—ã –≤—ã—Ö–æ–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏  
‚úÖ **–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –ª–æ–≥–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 10MB  

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∑–∞–ø—É—Å–∫–æ–º

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö cron –∑–∞–¥–∞—á
crontab -l

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
./run_email_processor.sh

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
tail -f cron.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
grep -i error cron.log

# –£–¥–∞–ª–µ–Ω–∏–µ cron –∑–∞–¥–∞—á–∏
crontab -e  # –∏ —É–¥–∞–ª–∏—Ç–µ —Å—Ç—Ä–æ–∫—É —Å email-processor
```

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–æ–≤
- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: –†–æ—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 10 MB, —Ö—Ä–∞–Ω–µ–Ω–∏–µ 30 –¥–Ω–µ–π
- **Cron**: –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 10 MB, –æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π
- **–§–æ—Ä–º–∞—Ç**: timestamp | level | module:function:line | message

### –§–∞–π–ª—ã –ª–æ–≥–æ–≤
```
email-processor/
‚îú‚îÄ‚îÄ cron.log                     # –õ–æ–≥–∏ cron + Docker + –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ cron.log.YYYYMMDD_HHMMSS.gz  # –ê—Ä—Ö–∏–≤—ã –±–æ–ª—å—à–∏—Ö –ª–æ–≥–æ–≤
‚îî‚îÄ‚îÄ logs/
    ‚îî‚îÄ‚îÄ email_processor.log      # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Docker volume)
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
```bash
# –õ–æ–≥–∏ cron –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–≤—Å–µ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ)
tail -f cron.log

# –¢–æ–ª—å–∫–æ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker compose run --rm email-processor tail -f /app/logs/email_processor.log

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤
tail -100 cron.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å
grep -i error cron.log | grep "$(date +%Y-%m-%d)"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤
grep -E "(–∑–∞–≤–µ—Ä—à–∏–ª—Å—è —É—Å–ø–µ—à–Ω–æ|–∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π)" cron.log | tail -10
```

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–í—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–µ–∫—Ç–æ–º —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.

## üö® –†–µ—à–µ–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "Conflict. The container name is already in use"

```bash
# –ü—Ä–æ–±–ª–µ–º–∞: –ü—ã—Ç–∞–µ—Ç–µ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–º–µ–Ω–µ–º, –∫–æ—Ç–æ—Ä–æ–µ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
# –†–µ—à–µ–Ω–∏–µ:
docker rm email-processor              # –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose up email-processor      # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ

# –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
docker ps -a | grep email-processor    # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```

### –û—à–∏–±–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–µ

```bash
# –ü—Ä–æ–±–ª–µ–º–∞: –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –∏–ª–∏ –∑–∞–≤–∏—Å–∞–µ—Ç
# –†–µ—à–µ–Ω–∏—è:
docker restart $(docker ps -q)         # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
# –∏–ª–∏
docker system prune -f                 # –û—á–∏—Å—Ç–∫–∞ Docker –∫–µ—à–∞
docker-compose up --force-recreate email-processor
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å .env —Ñ–∞–π–ª–æ–º

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ .env —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω:
ls -la .env                           # –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–∞–π–ª
cat .env | head -5                    # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ (–ø–µ—Ä–≤—ã–µ 5 —Å—Ç—Ä–æ–∫)

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ .env –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (—Ä—è–¥–æ–º —Å docker-compose.yml)
```

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ä–∞–∑—É –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
docker-compose logs email-processor   # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ª–æ–≥–∏
docker-compose logs --tail=50 email-processor  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫

# –ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
# - –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ .env (email, –ø–∞—Ä–æ–ª—å)
# - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
# - –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
```

## ‚ùó –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### Email –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **EMAIL_ADDRESS**: –í–∞—à Gmail –∞–¥—Ä–µ—Å
- **EMAIL_PASSWORD**: App Password (–Ω–µ –æ–±—ã—á–Ω—ã–π –ø–∞—Ä–æ–ª—å!)
- –°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç –ø–∏—Å—å–º–∞ —Å —Ç–µ–º–æ–π: `–í—ã–ø–∏—Å–∫–∞ –ø–æ —Å—á–µ—Ç—É –û–û–û "–ê–î–í–ê–ù–¢–û"`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–∏—Å—å–º–∞ —Å download —Å—Å—ã–ª–∫–∞–º–∏

### CSV –æ–±—Ä–∞–±–æ—Ç–∫–∞  
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –≤—ã–ø–∏—Å–æ–∫
- –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–ª–∞—Ç–µ–∂–∏ –ø–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ê–û "–¢–ë–∞–Ω–∫")
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç: –ò–ù–ù, —Å—É–º–º—É, –¥–∞—Ç—É, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

### Browser automation
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Chromium –≤ headless —Ä–µ–∂–∏–º–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞–µ—Ç ZIP/RAR/7Z –∞—Ä—Ö–∏–≤—ã
- –¢—Ä–µ–±—É–µ—Ç X11 (–ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Docker)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- üîê –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ App Passwords –¥–ª—è Gmail ([–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è](https://support.google.com/accounts/answer/185833))
- üõ°Ô∏è –•—Ä–∞–Ω–∏—Ç–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤ .env —Ñ–∞–π–ª–µ
- üîí –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è webhook URL
- üìù –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- üö´ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env —Ñ–∞–π–ª –≤ git

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
